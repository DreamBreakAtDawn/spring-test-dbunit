<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7 at 2016-04-14 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160414" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Spring Test DBUnit &#x2013; Introduction</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/springtestdbunit/spring-test-dbunit">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Spring Test DBUnit</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="http://www.github.com" class="externalLink" title="GitHub">
        GitHub</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="https://github.com/springtestdbunit/spring-test-dbunit" class="externalLink" title="spring-test-dbunit">
        spring-test-dbunit</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Introduction</li>
        
              
                <li id="projectVersion" class="pull-right">Version: 1.3.0-SNAPSHOT</li>
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.junit.org/" class="externalLink" title="JUnit">
        JUnit</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://www.dbunit.org/" class="externalLink" title="DBUnit">
        DBUnit</a>
      </li>

  
    <li class="pull-right">
                      <a href="http://www.springsource.org/get-started" class="externalLink" title="Spring Framework">
        Spring Framework</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li class="active">
  
            <a href="#"><span class="none"></span>Spring-Test DBUnit</a>
          </li>
                
      <li>
  
                          <a href="sample.html" title="Quick Start Example">
          <span class="none"></span>
        Quick Start Example</a>
            </li>
                
      <li>
  
                          <a href="faq.html" title="Frequently Asked Questions">
          <span class="none"></span>
        Frequently Asked Questions</a>
            </li>
                                        <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                              
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-down"></span>
        Project Information</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="dependencies.html" title="Dependencies">
          <span class="none"></span>
        Dependencies</a>
            </li>
                    
      <li>
  
                          <a href="dependency-info.html" title="Dependency Information">
          <span class="none"></span>
        Dependency Information</a>
            </li>
                    
      <li>
  
                          <a href="distribution-management.html" title="Distribution Management">
          <span class="none"></span>
        Distribution Management</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>About</a>
          </li>
                    
      <li>
  
                          <a href="issue-tracking.html" title="Issue Management">
          <span class="none"></span>
        Issue Management</a>
            </li>
                    
      <li>
  
                          <a href="license.html" title="Licenses">
          <span class="none"></span>
        Licenses</a>
            </li>
                    
      <li>
  
                          <a href="plugin-management.html" title="Plugin Management">
          <span class="none"></span>
        Plugin Management</a>
            </li>
                    
      <li>
  
                          <a href="plugins.html" title="Plugins">
          <span class="none"></span>
        Plugins</a>
            </li>
                    
      <li>
  
                          <a href="team-list.html" title="Team">
          <span class="none"></span>
        Team</a>
            </li>
                    
      <li>
  
                          <a href="source-repository.html" title="Source Code Management">
          <span class="none"></span>
        Source Code Management</a>
            </li>
                    
      <li>
  
                          <a href="project-summary.html" title="Summary">
          <span class="none"></span>
        Summary</a>
            </li>
              </ul>
        </li>
                                                                                                                                                                              
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Introduction</h1>
<p>Spring DBUnit provides integration between the Spring testing framework and the popular DBUnit project. It allows you to setup and teardown database tables using simple annotations as well as checking expected table contents once a test completes.</p>
<p>The project can be configured to run DBUnit tests using a Spring TestExecutionListener.</p>
<h1>Configuration</h1>
<p>To have Spring process DBUnit annotations you must first configure your tests to use the <tt>DbUnitTestExecutionListener</tt> class. To do this you need to use the Spring <tt>@TestExecutionListeners</tt> annotation. Generally, as well as <tt>DbUnitTestExecutionListener</tt>, you will also want to include the standard Spring listeners as well. Here are the annotations for a typical JUnit 4 test:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
       DirtiesContextTestExecutionListener.class,
      TransactionalTestExecutionListener.class,
       DbUnitTestExecutionListener.class })
</pre></div></div>
<p>See the Spring JavaDocs for details of the standard listeners.</p>
<p>In order to access the database, Spring DBUnit requires a bean to be registered in your test context. By default a bean named <tt>dbUnitDatabaseConnection</tt> or <tt>dataSource</tt> can be used (see the Advanced Configuration section below if you need to use another name). The bean can reference either a <tt>IDatabaseConnection</tt> or more typically a standard Java <tt>DataSource</tt>. Here is a typical XML configuration for accessing an in-memory hypersonic database:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;org.hsqldb.jdbcDriver&quot; /&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:hsqldb:mem:paging&quot; /&gt;
    &lt;property name=&quot;username&quot; value=&quot;sa&quot; /&gt;
    &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;
&lt;/bean&gt;
</pre></div></div>
<p>Once you have configured the <tt>DbUnitTestExecutionListener</tt> and provided the bean to access you database you can use the DBUnit annotations.</p>
<h1>Setup and TearDown</h1>
<p>Note: You need to complete the steps from the configuration section above before any annotations can be used. Without appropriate configuration DBUnit annotations will be silently ignored.</p>
<p>The <tt>@DatabaseSetup</tt> and <tt>@DatabaseTearDown</tt> annotations can be used to configure database table before tests execute and reset them once tests have completed.</p>
<h1>Setup</h1>
<p>The <tt>@DatabaseSetup</tt> annotation indicates how database tables should be setup before test methods are run. The annotation can be applied to individual test methods or to a whole class. When applied at the class level the setup occurs before each method in the test. The annotation value references a file that contains the table DataSet used when resetting the database. Typically this is a standard DBUnit XML file, although it is possible to load custom formats (see below).</p>
<p>Here is a typical setup annotation. In this case a file named <tt>sampleData.xml</tt> is contained in the same package as the test class.</p>

<div class="source">
<div class="source"><pre class="prettyprint">@DatabaseSetup(&quot;sampleData.xml&quot;)
</pre></div></div>
<p>It is also possible to reference specific resource locations, for example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@DatabaseSetup(&quot;/META-INF/dbtest/sampleData.xml&quot;)
</pre></div></div>
<p>By default setup will perform a <tt>CLEAN_INSERT</tt> operation, this means that all data from tables referenced in the DataSet XML will be removed before inserting new rows. The standard DBUnit operations are supported using type attribute. See the JavaDocs for full details.</p>
<h1>TearDown</h1>
<p>The <tt>@DatabaseTearDown</tt> annotation can be used to reset database tables once a test has completed. As with <tt>@DatabaseSetup</tt> the annotation can be applied at the method or class level. When using <tt>@DatabaseTearDown</tt> use the value and type attributes in the same way as <tt>@DatabaseSetup</tt>.</p>
<p>Note: If you are running a teardown in conjunction with a <tt>@Transactional</tt> test you may need to use an alternative configuration. See the section on below.</p>
<h1>Expected results</h1>
<p>The <tt>@ExpectedDatabase</tt> annotation can be used to verify the contents of database once a test has completed. You would typically use this annotation when a test performs an insert, update or delete. You can apply the annotation on a single test method or a class. When applied at the class level verification occurs after each test method.</p>
<p>The <tt>@ExpectedDatabase</tt> annotation takes a value attribute that references the DataSet file used to verify results. Here is a typical example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@ExpectedDatabase(&quot;expectedData.xml&quot;)
</pre></div></div>
<p>The <tt>@ExpectedDatabase</tt> annotation supports two different modes. <tt>DatabaseAssertionMode.DEFAULT</tt> operates as any standard DbUnit test, performing a complete compare of the expected and actual datasets. <tt>DatabaseAssertionMode.NON_STRICT</tt> will ignore tables and column names which are not specified in the expected dataset but exist in the actual datasets. This can be useful during integration tests performed on live databases containing multiple tables that have many columns, so one must not specify all of them, but only the &#x2018;interesting&#x2019; ones.</p>
<p>Note: If you are using this annotation in conjunction with a <tt>@Transactional</tt> test you may need to use an alternative configuration. See the section on below.</p>
<h1>Transactions</h1>
<p>If you have configured DBUnit tests to run using the are <tt>DbUnitTestExecutionListener</tt> and are also using the <tt>TransactionalTestExecutionListener</tt> you may experience problems with transactions not being started before your data is setup, or being rolled back before expected results can be verified. In order to support <tt>@Transactional</tt> tests with DBUnit you should use the <tt>TransactionDbUnitTestExecutionListener</tt> class.</p>
<p>Here are the annotations for a typical JUnit 4 test:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@Transactional
@TestExecutionListeners({ DependencyInjectionTestExecutionListener.class,
       DirtiesContextTestExecutionListener.class,
       TransactionDbUnitTestExecutionListener.class })
</pre></div></div>
<p>Transactions start before <tt>@DatabaseSetup</tt> and end after <tt>@DatabaseTearDown</tt> and <tt>@ExpectedDatabase</tt>.</p>
<h1>Advanced configuration of the DbUnitTestExecutionListener</h1>
<p>The <tt>@DbUnitConfiguration</tt> annotation can be used if you need to configure advanced options for DBUnit.</p>
<p>The databaseConnection attribute allows you to specify a specific bean name from the Spring Context that contains the database connection. When not specified the names or can be used. The bean must be either an <tt>IDatabaseConnection</tt> or a <tt>DataSource</tt>.</p>
<p>The <tt>dataSetLoader</tt> or <tt>dataSetLoaderBean</tt> attribute allows you to specify a custom loader that will be used when reading datasets (see below). If no specific loader is specified a <tt>dbUnitDataSetLoader</tt> bean will be used from the <tt>ApplicationContext</tt> (or if no such bean exists, the <tt>FlatXmlDataSetLoader</tt> will be used).</p>
<p>The <tt>databaseOperationLookup</tt> attribute allows you to specify a custom lookup strategy for DBUnit database operations (see below).</p>
<h1>Working with multiple connections</h1>
<p>It is possible to configure Spring Test DBUnit to work with multiple connections within the same test. First declare multiple <tt>DataSource</tt> or <tt>IDatabaseConnection</tt> beans in your application context. For example, here is XML configuration for two in-memory databases:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;org.hsqldb.jdbcDriver&quot; /&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:hsqldb:mem:paging&quot; /&gt;
    &lt;property name=&quot;username&quot; value=&quot;sa&quot; /&gt;
    &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;
&lt;/bean&gt;
&lt;bean id=&quot;customerDataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;org.hsqldb.jdbcDriver&quot; /&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:hsqldb:mem:customers&quot; /&gt;
    &lt;property name=&quot;username&quot; value=&quot;sa&quot; /&gt;
    &lt;property name=&quot;password&quot; value=&quot;&quot; /&gt;
&lt;/bean&gt;
</pre></div></div>
<p>You then need to use the <tt>@DbUnitConfiguration</tt> on your test to link to the connections:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@DbUnitConfiguration(databaseConnection={&quot;dataSource&quot;, &quot;customerDataSource&quot;})
</pre></div></div>
<p>The <tt>@DatabaseSetup</tt>, <tt>@DatabaseTearDown</tt> and <tt>@ExpectedDatabase</tt> annotations all have a <tt>connection</tt> attribute which can be used if you need to target a specific connection. If you don&#x2019;t specify a <tt>connection</tt> the first <tt>databaseConnection</tt> from <tt>@DbUnitConfiguration</tt> will be used (&#x201c;dataSource&#x201d; in the example above).</p>
<p>Spring Test DBUnit Annotations are repeatable so if you are using Java 8+ you can use several with the same test. For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@Test
@DatabaseSetup(value = &quot;insert.xml&quot;)
@DatabaseSetup(connection=&quot;customerDataSource&quot;, value=&quot;insert-custs.xml&quot;)
public void testInsert() throws Exception {
    // Inserts &quot;insert.xml&quot; into dataSource and &quot;insert-custs.xml&quot; into customerDataSource
    // ...
}
</pre></div></div>
<p>If you are using an earlier version of Java you will need to use one of the wrapper annotations:</p>

<div class="source">
<div class="source"><pre class="prettyprint">@Test
@DatabaseSetups({
    @DatabaseSetup(value = &quot;insert.xml&quot;)
    @DatabaseSetup(connection=&quot;customerDataSource&quot;, value=&quot;insert-custs.xml&quot;)
})
public void testInsert() throws Exception {
    // Inserts &quot;insert.xml&quot; into dataSource and &quot;insert-custs.xml&quot; into customerDataSource
    // ...
}
</pre></div></div>
<h1>Custom IDatabaseConnections</h1>
<p>In some situations you may need to create an <tt>IDatabaseConnection</tt> with a specific DBUnit configuration. Unfortunately, the standard DBUnit DatabaseConfig class cannot be easily using with Spring. In order to overcome this limitation, the <tt>DatabaseConfigBean</tt> provides an alternative method to configure a connection; with standard getter/setter access provided for all configuration options. The <tt>DatabaseDataSourceConnectionFactoryBean</tt> accepts a configuration property and should be used to construct the final connection. Here is a typical example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;dbUnitDatabaseConfig&quot; class=&quot;com.github.springtestdbunit.bean.DatabaseConfigBean&quot;&gt;
    &lt;property name=&quot;skipOracleRecyclebinTables&quot; value=&quot;true&quot;/&gt;
&lt;/bean&gt;
&lt;bean id=&quot;dbUnitDatabaseConnection&quot; class=&quot;com.github.springtestdbunit.bean.DatabaseDataSourceConnectionFactoryBean&quot;&gt;
    &lt;property name=&quot;databaseConfig&quot; ref=&quot;dbUnitDatabaseConfig&quot;/&gt;
&lt;/bean&gt;
</pre></div></div>
<p>NOTE: In most circumstances the username and password properties should not be set on the <tt>DatabaseDataSourceConnectionFactoryBean</tt>. These properties will cause DBUnit to start a new transaction and may cause unexpected behavior.</p>
<h1>Writing a DataSet Loader</h1>
<p>By default DBUnit datasets are loaded from flat XML files. If you need to load data from another source you will need to write your own DataSet loader and configure your tests to use it. Custom loaders must implement the <tt>DataSetLoader</tt> interface and provide an implementation of the <tt>loadDataSet</tt> method. The <tt>AbstractDataSetLoader</tt> is also available and provides a convenient base class for most loaders.</p>
<p>Here is an example loader that reads data from a CSV formatted file.</p>

<div class="source">
<div class="source"><pre class="prettyprint">public class CsvDataSetLoader extends AbstractDataSetLoader {
    protected IDataSet createDataSet(Resource resource) throws Exception {
       return new CsvURLDataSet(resource.getURL());
    }
}
</pre></div></div>
<p>See above for details of how to configure a test class to use the loader.</p>
<h1>Custom DBUnit Database Operations</h1>
<p>In some situations you may need to use custom DBUnit DatabaseOperation classes. For example, DBUnit includes <tt>org.dbunit.ext.mssql.InsertIdentityOperation</tt> for use with Microsoft SQL Server. The <tt>DatabaseOperationLookup</tt> interface can be used to create your own lookup strategy if you need support custom operations. A <tt>MicrosoftSqlDatabaseOperationLookup</tt> class is provided to support the aforementioned MSSQL operations.</p>
<p>See above for details of how to configure a test class to use the custom lookup.</p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2016.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
